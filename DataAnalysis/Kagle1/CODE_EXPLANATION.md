# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ –∫–æ–¥–∞ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Kagle1

## üìã –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç `Kagle1` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **end-to-end –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏** (–∑–∞–¥–∞—á–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –≤ —Å—Ç–∏–ª–µ Kaggle). –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å —Ü–∏–∫–ª –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è: –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Kagle1/
‚îú‚îÄ‚îÄ cars_price_pipeline.py    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îú‚îÄ‚îÄ README.md                  # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ submit.csv                 # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îî‚îÄ‚îÄ eda_summary.md         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π EDA –æ—Ç—á—ë—Ç
‚îú‚îÄ‚îÄ artifacts/
‚îÇ   ‚îî‚îÄ‚îÄ model_metrics.json     # –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–¥–µ–ª–µ–π (MAE –ø–æ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ hold-out)
‚îî‚îÄ‚îÄ catboost_info/            # –õ–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è CatBoost (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è)
```

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –ø–æ –ø—É—Ç—è–º:**
   - Train: `/Users/aleksey/Downloads/cars_train.csv`
   - Test: `/Users/aleksey/Downloads/cars-1-hw/cars_test.csv`

2. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
   ```bash
   pip install pandas numpy scikit-learn lightgbm xgboost catboost
   ```

### –ó–∞–ø—É—Å–∫

```bash
cd /Users/aleksey/ProjectsVS/FoodRTF/Kagle1
python cars_price_pipeline.py
```

---

## üîÑ –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞

### –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```python
train_raw = pd.read_csv(TRAIN_PATH)
test_raw = pd.read_csv(TEST_PATH)
```
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è CSV-—Ñ–∞–π–ª—ã —Å –æ–±—É—á–∞—é—â–µ–π –∏ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∞–º–∏ –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π.

---

### –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`_prepare_dataframe`)

–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç **feature engineering** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

#### 2.1 –û—á–∏—Å—Ç–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
- **Engine, Distance, Cylinders**: –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —á–∏—Å–ª–∞ –∏–∑ —Å—Ç—Ä–æ–∫, —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–æ–±–µ–ª—ã –∏ –∑–∞–ø—è—Ç—ã–µ.
- –ü—Ä–∏–º–µ—Ä: `"1,500"` ‚Üí `1500.0`

#### 2.2 –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

**–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:**
- `Age` = —Ç–µ–∫—É—â–∏–π –≥–æ–¥ - –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
- `Is_modern` = 1, –µ—Å–ª–∏ –≥–æ–¥ >= 2016
- `Is_oldtimer` = 1, –µ—Å–ª–∏ –≥–æ–¥ <= 2005
- `Year_bucket` = –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ–¥–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º (1985-1995, 1995-2000, ...)

**–õ–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:**
- `Distance_log` = log(1 + Distance) ‚Äî –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- `Engine_log` = log(1 + Engine)
- `Log_Age` = log(1 + Age)

**–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è:**
- `Distance_per_year` = Distance / (Age + 1) ‚Äî –ø—Ä–æ–±–µ–≥ –≤ –≥–æ–¥
- `Engine_per_cyl` = Engine / Cylinders ‚Äî –æ–±—ä—ë–º –Ω–∞ —Ü–∏–ª–∏–Ω–¥—Ä
- `Engine_to_age` = Engine / (Age + 1)
- `Distance_engine_ratio` = Distance / (Engine^1.2 + 0.1)
- `Cylinder_density` = Cylinders / (Engine + 0.1)

**–ë–∏–Ω–∞—Ä–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**
- `Transmission_manual` = 1, –µ—Å–ª–∏ —Ä—É—á–Ω–∞—è –∫–æ—Ä–æ–±–∫–∞
- `Drive_4x4` = 1, –µ—Å–ª–∏ –ø–æ–ª–Ω—ã–π –ø—Ä–∏–≤–æ–¥
- `Is_automatic` = 1, –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä–æ–±–∫–∞
- `Is_diesel` = 1, –µ—Å–ª–∏ –¥–∏–∑–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ
- `Is_hybrid` = 1, –µ—Å–ª–∏ –≥–∏–±—Ä–∏–¥/—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π
- `Is_luxury_make` = 1, –µ—Å–ª–∏ –º–∞—Ä–∫–∞ –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–µ–º–∏—É–º (BMW, Mercedes-Benz, Lexus, ...)
- `Is_popular_color` = 1, –µ—Å–ª–∏ —Ü–≤–µ—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–π (Black, White, Silver, ...)
- `Is_suv_style` = 1, –µ—Å–ª–∏ —Å—Ç–∏–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ SUV/Jeep/Crossover
- `Is_new_distance` = 1, –µ—Å–ª–∏ –ø—Ä–æ–±–µ–≥ < 1000 –∫–º
- `Is_zero_distance` = 1, –µ—Å–ª–∏ –ø—Ä–æ–±–µ–≥ = 0

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:**
- `Make_Model` = Make + "_" + Model (–Ω–∞–ø—Ä–∏–º–µ—Ä, "TOYOTA_CAMRY")
- `Make_Style` = Make + "_" + Style
- `Fuel_Transmission` = Fuel + "_" + Transmission

#### 2.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º `"Unknown"`
- –ß–∏—Å–ª–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –º–µ–¥–∏–∞–Ω–æ–π

---

### –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è EDA –æ—Ç—á—ë—Ç–∞ (`generate_eda_report`)

–°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `reports/eda_summary.md` —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
- –°—Ä–µ–¥–Ω—è—è/–º–µ–¥–∏–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
- –î–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤ –≤—ã–ø—É—Å–∫–∞
- –ú–µ–¥–∏–∞–Ω–Ω—ã–π –ø—Ä–æ–±–µ–≥
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø—É –ø—Ä–∏–≤–æ–¥–∞
- –¢–æ–ø-10 –º–∞—Ä–æ–∫ –ø–æ –æ–±—ä—ë–º—É –ø—Ä–æ–¥–∞–∂ –∏ –º–µ–¥–∏–∞–Ω–Ω–æ–π —Ü–µ–Ω–µ
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å —Ü–µ–Ω–æ–π

---

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –∫ train –∏ test (`apply_shared_stats`)

–î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è **—á–∞—Å—Ç–æ—Ç—ã –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏** –Ω–∞ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ (train + test):
- `Make_count`, `Model_count`, `Style_count`, `Fuel_count`, `Color_count`, ...
- –≠—Ç–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏ –≤ train, –∏ –≤ test –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.

---

### –®–∞–≥ 5: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤—ã—Ö —Ñ—Ä–µ–π–º–æ–≤ (`build_feature_frames`)

–°–æ–∑–¥–∞—é—Ç—Å—è **–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**:

#### 5.1 –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º (`train_cat`, `test_cat`)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏ (–¥–ª—è CatBoost, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –Ω–∞–ø—Ä—è–º—É—é)
- –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏

#### 5.2 –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º (`train_enc`, `test_enc`)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `LabelEncoder` (–≤ —á–∏—Å–ª–∞)
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è **target encodings** (`*_te`) ‚Äî —Å—Ä–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (—Å–º. –Ω–∏–∂–µ)
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è **frequency encodings** (`*_freq`) ‚Äî —á–∞—Å—Ç–æ—Ç—ã –≤—Å—Ç—Ä–µ—á–∞–µ–º–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### 5.3 Target Encoding (`add_target_encodings`)

**–í–∞–∂–Ω–æ:** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **out-of-fold (OOF) encoding** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è data leakage:

1. –î–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏ (Make, Model, Style, ...):
   - –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ 5 —Ñ–æ–ª–¥–æ–≤ (KFold)
   - –í –∫–∞–∂–¥–æ–º —Ñ–æ–ª–¥–µ: –Ω–∞ train —á–∞—Å—Ç–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –≠—Ç–∞ —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Å—Ç—Ä–æ–∫–∞–º –≤ validation —á–∞—Å—Ç–∏
   - –î–ª—è test –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, –≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è –Ω–∞ –≤—Å—ë–º train

2. –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–ª–æ–Ω–∫–∏ `Make_te`, `Model_te`, `Style_te`, ... —Å–æ–¥–µ—Ä–∂–∞—Ç "–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ" —Ü–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

---

### –®–∞–≥ 6: –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π (`evaluate_models`)

–¢–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è **—Ç—Ä–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ –±—É—Å—Ç–∏–Ω–≥–∞**:

#### 6.1 LightGBM
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º (`train_enc`)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: 1500 –¥–µ—Ä–µ–≤—å–µ–≤, learning_rate=0.03, num_leaves=80
- –ú–µ—Ç—Ä–∏–∫–∞: MAE (Mean Absolute Error)

#### 6.2 XGBoost
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º (`train_enc`)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: 1200 –¥–µ—Ä–µ–≤—å–µ–≤, learning_rate=0.03, max_depth=8
- –ú–µ—Ç—Ä–∏–∫–∞: MAE

#### 6.3 CatBoost
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º (`train_cat`) ‚Äî –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –Ω–∞–ø—Ä—è–º—É—é
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: 1800 –∏—Ç–µ—Ä–∞—Ü–∏–π, learning_rate=0.035, depth=8
- –ú–µ—Ç—Ä–∏–∫–∞: MAE

**–ü—Ä–æ—Ü–µ—Å—Å –æ—Ü–µ–Ω–∫–∏:**
- 5-fold –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏—è (KFold)
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ–ª–¥–∞ –æ–±—É—á–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è MAE –Ω–∞ validation —á–∞—Å—Ç–∏
- –ò—Ç–æ–≥–æ–≤–∞—è –º–µ—Ç—Ä–∏–∫–∞ = —Å—Ä–µ–¥–Ω–µ–µ MAE –ø–æ –≤—Å–µ–º —Ñ–æ–ª–¥–∞–º

---

### –®–∞–≥ 7: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ hold-out (`evaluate_holdout_models`)

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–¥–µ–ª–∏ –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –Ω–∞ **–æ–¥–Ω–æ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º hold-out** (20% –¥–∞–Ω–Ω—ã—Ö):
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∏–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–±–æ–ª—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤, –¥—Ä—É–≥–∏–µ learning rates)
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `model_metrics.json`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
```json
{
  "cv": {
    "lightgbm": 8394.02,
    "xgboost": 38077.89,
    "catboost": 8802.41
  },
  "holdout": {
    "lightgbm": 5743.49,
    "xgboost": 5918.57,
    "catboost": 6604.99
  }
}
```

---

### –®–∞–≥ 8: –û–±—É—á–µ–Ω–∏–µ –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ (`fit_best_model`)

1. –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å —Å **–Ω–∞–∏–º–µ–Ω—å—à–∏–º MAE –Ω–∞ hold-out** (–æ–±—ã—á–Ω–æ LightGBM –∏–ª–∏ XGBoost)
2. –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ **–≤—Å—ë–º train –¥–∞—Ç–∞—Å–µ—Ç–µ** (–±–µ–∑ —Ä–∞–∑–±–∏–µ–Ω–∏—è)
3. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `evaluate_holdout_models`

---

### –®–∞–≥ 9: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

1. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–µ–ª–∞—é—Ç—Å—è –¥–ª—è –≤—Å–µ–≥–æ test –¥–∞—Ç–∞—Å–µ—Ç–∞
2. –°–æ–∑–¥–∞—ë—Ç—Å—è DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `ID` –∏ `Predict`
3. –£–¥–∞–ª—è—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ID (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–∞–π–ª `submit.csv` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞

---

## üìä –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ data leakage
- Target encoding –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ OOF (out-of-fold) ‚Äî –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥—Ä—É–≥–∏—Ö —Ñ–æ–ª–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—á–∞—Å—Ç–æ—Ç—ã, counts) –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–º train+test –¥–∞—Ç–∞—Å–µ—Ç–µ

### 2. –î–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º** ‚Äî –¥–ª—è CatBoost (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –Ω–∞–ø—Ä—è–º—É—é)
- **–ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º** ‚Äî –¥–ª—è LightGBM –∏ XGBoost (–Ω—É–∂–Ω—ã —á–∏—Å–ª–∞)

### 3. –û–±—à–∏—Ä–Ω—ã–π feature engineering
- –ë–æ–ª–µ–µ 50 –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è, –±–∏–Ω–∞—Ä–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### 4. –ê–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π
- –¢–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è 3 —Ä–∞–∑–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- –í—ã–±–∏—Ä–∞–µ—Ç—Å—è –ª—É—á—à–∏–π –ø–æ –º–µ—Ç—Ä–∏–∫–µ MAE

---

## üìÅ –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

### `submit.csv`
–§–æ—Ä–º–∞—Ç:
```csv
ID,Predict
1,12500.5
2,18900.2
...
```

### `reports/eda_summary.md`
–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç —Å –±–∞–∑–æ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –ø–æ –¥–∞–Ω–Ω—ã–º.

### `artifacts/model_metrics.json`
JSON —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π (MAE –ø–æ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ hold-out).

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –∫ –¥–∞–Ω–Ω—ã–º

–ï—Å–ª–∏ –≤–∞—à–∏ —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö, –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –Ω–∞—á–∞–ª–µ `cars_price_pipeline.py`:

```python
TRAIN_PATH = Path("/Users/aleksey/Downloads/cars_train.csv")
TEST_PATH = Path("/Users/aleksey/Downloads/cars-1-hw/cars_test.csv")
```

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:**
   - –ú–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —á–∏—Å–ª–æ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Optuna –∏–ª–∏ GridSearch –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ä–µ–≤—å–µ–≤ –¥–ª—è –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

3. **–ê–Ω—Å–∞–º–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π (blending/stacking)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞—Ç–µ –ø—Ä–æ–¥–∞–∂–∏)
   - –°—Ç—Ä–∞—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –º–∞—Ä–∫–∞–º/–≥–æ–¥–∞–º

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–∞–π–ø–ª–∞–π–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤: –æ—Ç feature engineering –¥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π. –ö–æ–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π –∫ –¥–∞–Ω–Ω—ã–º.

